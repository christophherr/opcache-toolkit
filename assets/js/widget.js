(()=>{"use strict";class t{constructor(t=5,s=6e4){this.failureCount=0,this.threshold=t,this.timeout=s,this.state="CLOSED",this.nextAttempt=Date.now()}async call(t){if("OPEN"===this.state){if(Date.now()<this.nextAttempt)throw new Error("Circuit breaker is OPEN");this.state="HALF_OPEN"}try{const s=await t();return this.onSuccess(),s}catch(t){throw this.onFailure(),t}}onSuccess(){this.failureCount=0,this.state="CLOSED"}onFailure(){this.failureCount++,this.failureCount>=this.threshold&&(this.state="OPEN",this.nextAttempt=Date.now()+this.timeout)}}document.addEventListener("DOMContentLoaded",()=>{const{statusEndpoint:s,healthEndpoint:e,nonce:a}=window.opcacheToolkitWPAdminDashboard||{},n=document.getElementById("opcache-toolkit-widget");if(!n)return;const i=new t(5,6e4);!async function(){try{const t=await i.call(()=>async function(t,s){const e=await fetch(t,{headers:{"X-WP-Nonce":s}});if(!e.ok)throw new Error(`Failed to fetch status: ${e.statusText}`);return await e.json()}(s,a)),o=await i.call(()=>async function(t,s){const e=await fetch(t,{headers:{"X-WP-Nonce":s}});if(!e.ok)throw new Error(`Failed to fetch health: ${e.statusText}`);return await e.json()}(e,a));if(!t.success||!o.success)return void(n.innerHTML=`<div class="opcache-toolkit-error">${t.message||o.message||"OPcache is unavailable."}</div>`);const c=t.data.opcache_statistics?.opcache_hit_rate.toFixed(1)+"%",r=(t.data.memory_usage?.used_memory/1024/1024).toFixed(1)+"MB";n.innerHTML=`\n\t\t\t\t<div class="opcache-widget-stats">\n\t\t\t\t\t<div class="stat"><strong>Hit Rate:</strong> <span>${c}</span></div>\n\t\t\t\t\t<div class="stat"><strong>Memory:</strong> <span>${r}</span></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="opcache-widget-health">\n\t\t\t\t\t<strong>Health:</strong> ${o.data.issues&&0===o.data.issues.length?"✅ OK":"⚠️ Issues Found"}\n\t\t\t\t</div>\n\t\t\t`}catch(t){n.innerHTML='<div class="error">Failed to load status.</div>'}}()})})();