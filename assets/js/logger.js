(()=>{"use strict";class e{constructor(e,o){this.logs=[],this.batchSize=10,this.batchInterval=5e3,this.endpoint=e,this.nonce=o,this.endpoint&&this.nonce&&this.startInterval()}log(e,o,t={}){this.logs.push({level:e,message:o,context:t,timestamp:(new Date).toISOString()}),this.logs.length>=this.batchSize&&this.flush()}info(e,o={}){this.log("info",e,o)}warn(e,o={}){this.log("warning",e,o)}error(e,o={}){this.log("error",e,o)}debug(e,o={}){this.log("debug",e,o)}async flush(){if(0===this.logs.length)return;const e=[...this.logs];this.logs=[];try{const o=await fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":this.nonce},body:JSON.stringify({logs:e})});o.ok||console.error("Failed to send logs to server",o.statusText)}catch(e){console.error("Error sending logs to server",e)}}startInterval(){setInterval(()=>this.flush(),this.batchInterval)}registerGlobalHandlers(){window.addEventListener("error",e=>{this.error("Global JS Error",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error?e.error.stack:null})}),window.addEventListener("unhandledrejection",e=>{this.error("Unhandled Promise Rejection",{reason:e.reason?e.reason.stack||e.reason:"Unknown"})})}}const o=window.opcacheToolkitData?.restUrl+"opcache-toolkit/v1/log",t=window.opcacheToolkitData?.nonce;if(o&&t){const s=new e(o,t);s.registerGlobalHandlers(),window.opcacheToolkitLogger=s}})();